window.addEventListener('load',()=>{const wait=()=>new Promise(r=>setTimeout(r,50));const ready=async()=>{while(!window.firebase||!firebase.auth)await wait();return firebase.auth()};ready().then(async auth=>{const status=document.getElementById('premiumState');const upgrade=document.getElementById('upgradeBtn');auth.onAuthStateChanged(async u=>{if(!u){status.textContent='Please sign in to check premium.'; upgrade.onclick=()=>location.href='/login.html'; return;} const t=await u.getIdTokenResult(true); const prem=!!t.claims.premium; status.textContent=prem?'You are Premium âœ…':'Premium locked.'; upgrade.classList.toggle('hidden',prem); upgrade.onclick=async()=>{try{const r=await fetch('/createCheckout',{method:'POST'}); const {url}=await r.json(); location.href=url;}catch(e){alert('Checkout failed: '+e.message)}};});});});
